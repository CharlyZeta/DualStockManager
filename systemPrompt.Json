{
  "project_name": "DualStock_Manager",
  "version": "0.2.9",
  "context": {
    "business_name": "Dual Equipamientos",
    "environment": "WordPress/WooCommerce Ecosystem",
    "architecture": "Hybrid: PHP Backend (REST API) + Alpine.js Frontend (SPA-like Dashboard)",
    "goal": "Omnichannel stock control with multi-location internal distribution, audit trails, and manual WC synchronization."
  },
  "technical_stack": {
    "backend": [
      "PHP (WordPress Core/wpdb)",
      "REST API (Custom Endpoints under /wp-json/dsm/v1/)",
      "Sync Engine (Class-based logic)"
    ],
    "frontend": [
      "Alpine.js (Reactive UI, Modals, Async Fetch)",
      "Vanilla CSS (Custom admin-dashboard.css)",
      "HTML5 QR Code Scanner"
    ],
    "database": [
      "wp_dual_inventory (Master Stock Table)",
      "wp_dual_inventory_logs (Transaction History)"
    ]
  },
  "database_schema": {
    "wp_dual_inventory": {
      "product_id": "BIGINT(20) UNSIGNED PRIMARY KEY",
      "stock_local": "INT DEFAULT 0 (Showroom)",
      "stock_deposito_1": "INT DEFAULT 0",
      "stock_deposito_2": "INT DEFAULT 0",
      "wc_stock": "INT (Cached copy of WC stock for comparison)",
      "last_audit_date": "DATETIME"
    },
    "wp_dual_inventory_logs": {
      "id": "BIGINT UNSIGNED AUTO_INCREMENT",
      "date_created": "DATETIME",
      "user_id": "BIGINT UNSIGNED",
      "product_id": "BIGINT UNSIGNED",
      "action_type": "VARCHAR(20) (edit, transfer, sync, revert)",
      "previous_state": "JSON (Snapshot of stocks before)",
      "new_state": "JSON (Snapshot of stocks after)",
      "details": "TEXT (Human readable description)"
    }
  },
  "business_logic_rules": {
    "inventory_identity": "Plugin Total = stock_local + stock_deposito_1 + stock_deposito_2",
    "discrepancy_handling": "Manual 'Fix WC' push. No automatic overwrite of WC on order placement.",
    "logging_policy": "ALL state changes must be logged. Reverts are also logged as new actions (type: revert).",
    "frontend_architecture": "Dashboard loads empty structure, then fetches JSON. 'History' tab uses lazy loading.",
    "security": "All API endpoints protected by Nonce ('wp_rest') and Capability ('manage_options')."
  },
  "functional_modules": {
    "dashboard": "Spreadsheet-like inline editing with AJAX autosave.",
    "transfer_modal": "Inline modal to move stock between locations. Validates source availability.",
    "history_log": "Tabular view of log entries with 'Undo' capability.",
    "audit_scanner": "Mobile-optimized QR/Barcode scanner for quick status checks.",
    "shortcode": "[dualstock_manager] allows frontend access for authorized users."
  },
  "implementation_status": [
    "DONE: Custom DB Tables (Inventory + Logs)",
    "DONE: Sync Engine & API (Inventory, Transfer, Fix-WC, Logs)",
    "DONE: Dashboard UI (Alpine.js, CSS Grid/Flex)",
    "DONE: Stock Transfer Logic (Inline Modal)",
    "DONE: History & Revert Logic",
    "DONE: Scanner Integration (html5-qrcode)"
  ]
}